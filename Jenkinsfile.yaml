pipelines:
  - name: build_and_deploy
    agent: any
    environment:
      DOCKERHUB_USERNAME: "pranav12444"
      DOCKERHUB_PASSWORD: "admin1234"
    stages:
      - name: Clone Repository
        steps:
          - checkout: scm

      - name: Build Docker Image
        steps:
          - sh: |
              docker build -t ${DOCKERHUB_USERNAME}/flask-app:latest .

      - name: Push to Docker Hub
        steps:
          - sh: |
              echo "${DOCKERHUB_PASSWORD}" | docker login -u "${DOCKERHUB_USERNAME}" --password-stdin
              docker push ${DOCKERHUB_USERNAME}/flask-app:latest

      - name: Deploy Container
        steps:
          - sh: |
              docker stop flask-app || true
              docker rm flask-app || true
              docker run -d -p 5000:5000 --name flask-app ${DOCKERHUB_USERNAME}/flask-app:latest
